#!/usr/bin/env bash
set -euo pipefail

CYAN="\033[1;36m"
GREEN="\033[1;32m"
YELLOW="\033[1;33m"
RED="\033[1;31m"
RESET="\033[0m"

log()      { echo -e "${CYAN}➜${RESET} $*"; }
log_ok()   { echo -e "${GREEN}✔${RESET} $*"; }
log_warn() { echo -e "${YELLOW}⚠${RESET} $*"; }
log_err()  { echo -e "${RED}✖${RESET} $*"; }

REPO_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
PROMPT_DIR="$REPO_ROOT/codex/prompts"

usage() {
  cat <<EOF
Usage: cx-template new <name>

Examples:
  cx-template new agent.devops
  cx-template new agent.rust
  cx-template new uaep.experimental
EOF
  exit 1
}

CMD="${1:-}"
NAME="${2:-}"

if [ "$CMD" != "new" ] || [ -z "$NAME" ]; then
  usage
fi

TARGET_FILE="$PROMPT_DIR/${NAME}.md"
TARGET_DIR="$(dirname "$TARGET_FILE")"

mkdir -p "$TARGET_DIR"

if [ -f "$TARGET_FILE" ]; then
  log_warn "Template already exists: $TARGET_FILE"
  exit 0
fi

cat > "$TARGET_FILE" <<EOF
# $NAME — Agent Template

## ROLE
You are an AI agent specialized in this domain:
- ...

## GOALS
- ...

## CONTEXT
The project uses:
- Language(s): ...
- Framework(s): ...
- Tools: ...

## RULES
- Use English.
- Keep responses structured and concise.
- Prefer safe, minimal changes.
- Respect existing architecture.
- Highlight security and performance considerations.

## OUTPUT FORMAT
Always respond using this structure:

1. PLAN
2. IMPLEMENTATION
3. RISKS
4. TODO

## NOTES FOR USER
Customize this file to match your project needs.
EOF

log_ok "Created template: $TARGET_FILE"

